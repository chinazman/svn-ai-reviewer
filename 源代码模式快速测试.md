# 源代码模式快速测试指南

## 测试准备

1. 确保已编译最新版本：
```bash
go build -o svn-ai-reviewer.exe
```

2. 确保配置文件存在：
```bash
# 检查 config.yaml 是否存在
dir config.yaml
```

## 测试步骤

### 1. 启动服务

```bash
svn-ai-reviewer.exe
```

预期输出：
```
🚀 SVN 代码审核工具已启动
📱 本地模式: http://localhost:8080
📱 在线模式: http://localhost:8080/online
📱 源代码模式: http://localhost:8080/source
📊 报告目录: http://localhost:8080/reports/
按 Ctrl+C 停止服务器
```

### 2. 访问源代码模式

在浏览器中打开：`http://localhost:8080/source`

### 3. 测试场景

#### 场景1：扫描当前目录的Go文件

1. **配置文件**：选择 `config.yaml`
2. **目录/文件路径**：输入 `.`
3. **过滤字符串**：输入 `*.go`
4. **最大文件数**：保持默认 `100`
5. 点击"扫描文件"
6. 验证：
   - 应该列出所有 .go 文件（最多100个）
   - 文件默认不勾选
   - 可以查看文件内容
   - 如果超过100个文件，会显示警告

#### 场景2：扫描cmd目录

1. **目录/文件路径**：输入 `cmd`
2. **过滤字符串**：输入 `*.go`
3. 点击"扫描文件"
4. 验证：
   - 应该列出 cmd 目录下的所有 .go 文件
   - 包括 root.go, online.go, review.go, source.go 等

#### 场景3：扫描单个文件

1. **目录/文件路径**：输入 `main.go`
2. **过滤字符串**：留空
3. 点击"扫描文件"
4. 验证：
   - 应该只列出 main.go 文件

#### 场景4：测试本地记忆功能

1. 输入路径和过滤条件
2. 点击"扫描文件"
3. 刷新页面（F5）
4. 验证：
   - 输入框应该自动恢复之前的内容

#### 场景5：测试文件选择

1. 扫描文件后
2. 验证默认不勾选
3. 手动勾选几个文件
4. 点击全选复选框
5. 验证所有文件被勾选
6. 再次点击全选复选框
7. 验证所有文件取消勾选

#### 场景6：查看文件内容

1. 扫描文件后
2. 点击某个文件的"查看内容"按钮
3. 验证：
   - 弹出模态框显示文件内容
   - 内容格式正确
   - 可以关闭模态框

#### 场景7：执行审核

1. 扫描文件
2. 勾选1-2个小文件（如 cmd/source.go）
3. 点击"开始审核"
4. 验证：
   - 按钮变为"审核中..."状态
   - 日志区域显示审核进度
   - 审核完成后自动打开报告
   - 按钮恢复为"开始审核"

#### 场景8：测试过滤规则

测试不同的过滤条件：

| 路径 | 过滤条件 | 最大文件数 | 预期结果 |
|------|---------|-----------|---------|
| `.` | `*.go` | 100 | 所有Go文件（最多100个） |
| `.` | `*.md` | 100 | 所有Markdown文件 |
| `cmd` | `*.go` | 100 | cmd目录下的Go文件 |
| `internal` | `*.go` | 100 | internal目录下的Go文件（递归） |
| `.` | 留空 | 50 | 所有文件（最多50个） |
| `.` | `*.go` | 10 | 所有Go文件（最多10个） |

#### 场景9：测试模式切换

1. 在源代码模式页面
2. 点击"本地模式"按钮
3. 验证跳转到本地模式页面
4. 点击"源代码模式"按钮
5. 验证跳转回源代码模式页面
6. 验证输入内容被保留

#### 场景10：测试文件数量限制

1. **测试默认限制**：
   - 路径：`.`
   - 过滤：留空
   - 最大文件数：100
   - 验证：如果文件超过100个，显示警告

2. **测试自定义限制**：
   - 路径：`.`
   - 过滤：`*.go`
   - 最大文件数：10
   - 验证：最多显示10个文件

3. **测试边界值**：
   - 测试最小值：1
   - 测试最大值：1000
   - 测试无效值：0、-1、1001

#### 场景11：测试错误处理

1. **无效路径**：
   - 输入不存在的路径
   - 验证显示错误提示

2. **未选择文件**：
   - 不勾选任何文件
   - 点击"开始审核"
   - 验证显示"请至少选择一个文件"

3. **未加载配置**：
   - 刷新页面
   - 不等配置加载完成
   - 直接扫描文件
   - 验证显示"请先加载配置文件"

4. **无效文件数量**：
   - 输入0或负数
   - 验证显示错误提示
   - 输入超过1000
   - 验证显示错误提示

## 测试检查清单

- [ ] 服务启动成功，显示源代码模式URL
- [ ] 可以访问源代码模式页面
- [ ] 配置文件加载成功
- [ ] 可以扫描目录
- [ ] 可以扫描单个文件
- [ ] 过滤条件生效
- [ ] 最大文件数限制生效
- [ ] 超过限制时显示警告
- [ ] 文件列表默认不勾选
- [ ] 可以手动勾选文件
- [ ] 全选功能正常
- [ ] 可以查看文件内容
- [ ] 可以执行审核
- [ ] 审核日志实时显示
- [ ] 审核完成后自动打开报告
- [ ] 输入内容自动保存和恢复（包括最大文件数）
- [ ] 模式切换正常
- [ ] 错误处理正确

## 常见问题排查

### 问题1：页面无法访问

**检查**：
- 服务是否启动
- 端口8080是否被占用
- 浏览器地址是否正确

### 问题2：扫描不到文件

**检查**：
- 路径是否正确
- 过滤条件是否正确
- 文件是否存在

### 问题3：审核失败

**检查**：
- 配置文件是否正确
- AI API密钥是否有效
- 网络连接是否正常

### 问题4：输入不保存

**检查**：
- 浏览器是否支持 localStorage
- 是否清除了浏览器缓存

## 性能测试

### 测试大量文件

1. 扫描整个项目：
```
路径：.
过滤：*.go
```

2. 记录：
   - 扫描时间
   - 文件数量
   - 页面响应速度

### 测试审核性能

1. 选择10个小文件
2. 记录：
   - 审核总时间
   - 每个文件平均时间
   - 报告生成时间

## 测试报告模板

```
测试日期：2025-11-07
测试人员：[姓名]
版本号：v1.0.0

测试结果：
✅ 基本功能正常
✅ 文件扫描正常
✅ 过滤功能正常
✅ 审核功能正常
✅ 本地记忆正常
✅ 错误处理正常

发现问题：
1. [问题描述]
2. [问题描述]

建议改进：
1. [改进建议]
2. [改进建议]
```

## 下一步

测试通过后，可以：
1. 更新主 README.md
2. 更新功能清单.md
3. 提交代码
4. 发布新版本
