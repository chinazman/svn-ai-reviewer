# 更新说明 - 支持本地SVN仓库（file://协议）

## 更新内容

### 主要改进
✅ **用户名和密码改为非必填项**，支持本地file://协议的SVN仓库

### 修改的文件

#### 1. `cmd/online.go` - CLI命令
**改动：**
- 移除了用户名密码的必填验证
- 添加了file://协议的检测
- 只有非file://协议才提示输入用户名密码
- 更新了提示信息

**代码变更：**
```go
// 之前：强制要求用户名密码
if svnUsername == "" {
    fmt.Print("请输入SVN用户名: ")
    fmt.Scanln(&svnUsername)
}

// 之后：只有非file://协议才要求
if !strings.HasPrefix(svnURL, "file://") {
    if svnUsername == "" {
        fmt.Print("请输入SVN用户名 (留空跳过): ")
        fmt.Scanln(&svnUsername)
    }
}
```

#### 2. `internal/svn/svn.go` - SVN客户端
**改动：**
- 所有SVN命令调用都改为条件性添加认证参数
- 只有在提供了用户名时才添加 `--username` 和 `--password`
- 支持密码为空的情况

**影响的函数：**
- `TestConnection()` - 测试连接
- `SearchLog()` - 搜索日志
- `GetRevisionDiff()` - 获取差异
- `GetRevisionFiles()` - 获取文件列表

**代码变更：**
```go
// 之前：总是添加认证参数
if c.username != "" {
    args = append(args, "--username", c.username)
    args = append(args, "--password", c.password)
    args = append(args, "--non-interactive")
}

// 之后：条件性添加，支持密码为空
if c.username != "" {
    args = append(args, "--username", c.username)
    if c.password != "" {
        args = append(args, "--password", c.password)
    }
    args = append(args, "--non-interactive")
}
```

#### 3. `gui/server.go` - GUI服务器
**改动：**
- 移除了用户名密码的必填验证
- 只验证URL是否提供
- 添加了更友好的错误提示

**代码变更：**
```go
// 添加URL验证
if req.URL == "" {
    respondJSON(w, map[string]interface{}{"error": "请提供SVN服务器地址"}, http.StatusBadRequest)
    return
}

// 用户名密码可以为空
svnClient := svn.NewOnlineClient("svn", req.URL, req.Username, req.Password)
```

#### 4. `gui/templates/online.html` - GUI界面
**改动：**
- 更新了输入框的placeholder提示
- 添加了file://协议的说明
- 添加了智能提示（非file://协议建议填写用户名）
- 更新了"记住凭据"为"记住配置"

**界面变更：**
```html
<!-- 之前 -->
<input type="text" id="svnURL" placeholder="SVN 服务器地址 (例如: https://svn.example.com/repo)">
<input type="text" id="svnUsername" placeholder="用户名">
<input type="password" id="svnPassword" placeholder="密码">

<!-- 之后 -->
<input type="text" id="svnURL" placeholder="SVN 服务器地址 (例如: https://svn.example.com/repo 或 file:///F:/path/to/repo)">
<input type="text" id="svnUsername" placeholder="用户名 (file:// 协议可留空)">
<input type="password" id="svnPassword" placeholder="密码 (file:// 协议可留空)">
```

**JavaScript变更：**
```javascript
// 添加智能提示
if (!url.startsWith('file://') && !username) {
    if (!confirm('未填写用户名，是否继续连接？\n(file:// 协议不需要用户名密码)')) {
        return;
    }
}
```

#### 5. 文档更新
**新增文档：**
- `本地仓库测试指南.md` - 详细的本地仓库测试说明

**更新文档：**
- `快速开始-在线模式.md` - 添加本地仓库示例
- `在线模式使用说明.md` - 添加file://协议说明和FAQ

## 使用示例

### CLI模式

#### 本地仓库（不需要用户名密码）
```bash
# 连接本地仓库
svn-reviewer review online --url file:///F:/02demo/myrepo/trunk --save

# 后续使用
svn-reviewer review online --keyword "bug"
```

#### 远程服务器（需要用户名密码）
```bash
# 连接远程服务器
svn-reviewer review online \
  --url https://svn.example.com/repo \
  --username zhangsan \
  --password 123456 \
  --save
```

### GUI模式

#### 本地仓库
```
SVN服务器地址: file:///F:/02demo/myrepo/trunk
用户名: (留空)
密码: (留空)
```

#### 远程服务器
```
SVN服务器地址: https://svn.example.com/repo
用户名: zhangsan
密码: 123456
```

## 兼容性

### 支持的SVN协议
- ✅ `file://` - 本地仓库（无需认证）
- ✅ `http://` - HTTP协议（可选认证）
- ✅ `https://` - HTTPS协议（可选认证）
- ✅ `svn://` - SVN协议（可选认证）
- ✅ `svn+ssh://` - SSH协议（可选认证）

### 认证场景
| 协议 | 用户名 | 密码 | 说明 |
|------|--------|------|------|
| file:// | 可选 | 可选 | 本地仓库，通常不需要 |
| http:// | 可选 | 可选 | 取决于服务器配置 |
| https:// | 推荐 | 推荐 | 通常需要认证 |
| svn:// | 推荐 | 推荐 | 通常需要认证 |
| svn+ssh:// | 可选 | 可选 | 使用SSH密钥时不需要 |

## 测试验证

### 测试场景
- [x] 本地file://协议，不提供用户名密码
- [x] 本地file://协议，提供用户名密码（兼容性）
- [x] 远程https://协议，提供用户名密码
- [x] 远程https://协议，不提供用户名密码（测试错误处理）
- [x] CLI模式所有场景
- [x] GUI模式所有场景
- [x] 编译通过

### 测试命令
```bash
# 编译
go build -o svn-reviewer.exe

# 测试本地仓库
svn-reviewer review online --url file:///F:/02demo/myrepo/trunk

# 测试远程仓库
svn-reviewer review online --url https://svn.example.com/repo --username user --password pass
```

## 向后兼容性

✅ **完全向后兼容**

- 原有的远程SVN服务器使用方式不受影响
- 仍然支持提供用户名密码
- 配置文件格式不变
- API接口不变

## 注意事项

1. **路径格式**
   - Windows: `file:///C:/path/to/repo`
   - Linux/Mac: `file:///home/user/repo`
   - 使用三个斜杠 `///`
   - Windows路径使用正斜杠 `/`

2. **权限要求**
   - 确保对本地仓库目录有读取权限
   - 某些情况下可能需要管理员权限

3. **安全性**
   - 本地仓库不需要网络连接
   - 不涉及密码传输
   - 适合测试和开发环境

## 优势

### 开发测试
- ✅ 无需搭建远程SVN服务器
- ✅ 快速验证功能
- ✅ 不需要网络连接
- ✅ 不需要配置认证

### 实际使用
- ✅ 支持本地备份仓库审核
- ✅ 支持离线工作
- ✅ 适合个人项目
- ✅ 适合内网环境

## 下一步

建议测试流程：
1. 使用本地file://仓库快速验证功能
2. 测试搜索和审核流程
3. 配置远程SVN服务器
4. 在实际项目中使用

## 相关文档

- 📖 `本地仓库测试指南.md` - 详细测试步骤
- 📖 `快速开始-在线模式.md` - 快速上手
- 📖 `在线模式使用说明.md` - 完整功能说明

---

**更新版本**: 1.1.0  
**更新日期**: 2024-01-15  
**状态**: ✅ 已测试通过
