# 本地SVN仓库测试指南

## 快速测试本地file://协议

### 前提条件
确保你有一个本地SVN仓库，例如：
```
F:/02demo/myrepo/trunk/scvtest1
```

### 方法一：CLI命令行测试

#### 1. 首次连接（保存配置）
```bash
svn-reviewer review online --url file:///F:/02demo/myrepo/trunk --save
```

**注意事项：**
- 不需要提供 `--username` 和 `--password` 参数
- 使用三个斜杠 `file:///`
- Windows路径使用正斜杠 `/`

#### 2. 搜索提交记录
程序会显示：
```
正在测试SVN服务器连接...
✓ SVN服务器连接成功
✓ SVN配置已保存到配置文件

正在搜索SVN提交记录...

找到 X 条提交记录:
  [1] rXXX | author | 2024-01-15 10:30:00
      提交信息...
```

#### 3. 选择版本和文件
```
请输入要审核的版本编号（用逗号分隔，例如: 1,3,5）:
> 1

检测到 X 个变更文件:
  [1] [修改] path/to/file.ext (rXXX)
  ...

请输入要审核的文件编号（用逗号分隔，或输入 'all' 审核所有文件）:
> all
```

#### 4. 查看审核结果
审核完成后会自动生成HTML报告并打开浏览器。

### 方法二：GUI图形界面测试

#### 1. 启动程序
```bash
svn-reviewer.exe
```

#### 2. 切换到在线模式
- 浏览器自动打开 http://localhost:8080
- 点击顶部的"在线模式"按钮

#### 3. 连接本地仓库
```
SVN服务器地址: file:///F:/02demo/myrepo/trunk
用户名: (留空)
密码: (留空)
☑ 记住配置
```
点击"连接服务器"

#### 4. 搜索和审核
- 输入搜索条件（可选）
- 点击"搜索"
- 勾选要审核的版本
- 点击"加载选中版本的文件"
- 勾选要审核的文件
- 点击"开始审核"

### 常见路径格式

#### Windows
```bash
# 绝对路径
file:///C:/svn/myrepo
file:///F:/02demo/myrepo/trunk
file:///D:/projects/svn-repo

# 注意：使用正斜杠，不是反斜杠
# 错误: file:///F:\02demo\myrepo\trunk
# 正确: file:///F:/02demo/myrepo/trunk
```

#### Linux/Mac
```bash
file:///home/user/svn/myrepo
file:///var/svn/projects/trunk
file:///Users/username/repos/myrepo
```

### 验证SVN仓库

在测试前，可以先用SVN命令验证仓库是否可访问：

```bash
# 查看仓库信息
svn info file:///F:/02demo/myrepo/trunk

# 查看日志
svn log file:///F:/02demo/myrepo/trunk --limit 5

# 如果这些命令能正常工作，说明仓库路径正确
```

### 故障排除

#### 问题1：连接失败
```
错误: 连接失败: svn: E170000: URL 'file:///...' 不存在
```
**解决方案：**
1. 检查路径是否正确
2. 确认使用三个斜杠 `file:///`
3. 确认路径使用正斜杠 `/`
4. 使用 `svn info` 命令验证路径

#### 问题2：没有提交记录
```
没有找到匹配的提交记录
```
**解决方案：**
1. 确认仓库中有提交记录
2. 使用 `svn log file:///path/to/repo` 查看是否有日志
3. 尝试不使用搜索条件

#### 问题3：权限错误
```
错误: svn: E720005: 无法打开文件
```
**解决方案：**
1. 确认对仓库目录有读取权限
2. 以管理员身份运行程序
3. 检查文件系统权限

### 配置文件示例

保存后的 `config.yaml` 会包含：

```yaml
ai:
  provider: "deepseek"
  api_key: "your-api-key"
  base_url: "https://api.deepseek.com/v1"
  model: "deepseek-chat"

svn:
  command: "svn"

# 本地仓库配置（用户名密码为空）
online:
  url: "file:///F:/02demo/myrepo/trunk"
  username: ""
  password: ""

report:
  output_dir: "./reports"
  auto_open: true
```

### 测试检查清单

- [ ] SVN命令行工具已安装 (`svn --version`)
- [ ] 本地仓库路径正确
- [ ] 使用 `svn info` 验证仓库可访问
- [ ] 配置文件中AI配置正确
- [ ] 能够连接到本地仓库
- [ ] 能够搜索提交记录
- [ ] 能够加载文件列表
- [ ] 能够执行审核
- [ ] 能够生成报告

### 完整测试流程

```bash
# 1. 验证SVN仓库
svn info file:///F:/02demo/myrepo/trunk

# 2. 查看日志确认有提交记录
svn log file:///F:/02demo/myrepo/trunk --limit 5

# 3. 运行在线审核
svn-reviewer review online --url file:///F:/02demo/myrepo/trunk --save

# 4. 按提示选择版本和文件

# 5. 查看生成的报告
# 报告会自动在浏览器中打开
```

### 性能说明

本地file://协议的优势：
- ✅ 无需网络连接
- ✅ 访问速度快
- ✅ 无需认证
- ✅ 适合测试和开发

### 下一步

测试成功后，可以：
1. 尝试搜索功能（按作者、关键词、路径）
2. 测试批量审核多个版本
3. 自定义审核规则
4. 配置远程SVN服务器

---

**提示：** 本地仓库测试是验证功能的最快方式，不需要网络和认证，非常适合快速体验和调试。
